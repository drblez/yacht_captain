\documentclass[a4paper, 12pt, twoside, final, book, russian, fittopage, cyremdash, openright]{ncc}
\listfiles
\usepackage[a4paper]{geometry}
\geometry{verbose, tmargin=3cm, bmargin=3cm, lmargin=2cm, rmargin=1.5cm, headheight=1cm, headsep=1cm, footskip=1.5cm}
\usepackage[T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}
\usepackage[export]{adjustbox}
%\usepackage{paratype}
%\usepackage[scaled=0.9]{PTSerif}
%\usepackage[scaled=0.9]{PTSans}
%\usepackage[scaled=0.9]{PTMono}
\usepackage{extdash}
% \usepackage[xindy]{imakeidx}
% \usepackage{index}
\usepackage{wrapfig}
\usepackage[above,below,section]{placeins}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{afterpage}
\usepackage{xltabular}
\usepackage{hyperref}
\usepackage{xspace}
\usepackage[headings]{ncchdr}
\usepackage{ncccomma}
\usepackage{desclist}
\usepackage{indentfirst}
\usepackage{upgreek}
\usepackage{marvosym}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{amsfonts}
\usepackage{enumerate}
\usepackage{rotating}
\usepackage{array}
\usepackage{graphicx}
\usepackage[font=small]{caption}
\usepackage{xfrac}
\usepackage{accents}
%\usepackage{tikz}
%\usepackage{subcaption}
\usepackage{xstring}
\usepackage{catchfile}
%\usepackage{microtype}
\usepackage{float}
\usepackage{footnotehyper}

\overfullrule=1mm

% \makeindex[
%   options= -M yacht_captain -L russian -I xindy -C utf8 -v -t yacht_captain.glg -o yacht_captain.gls yacht_captain.glo
% ]

\makeindex

% висячие и другие строки

\clubpenalty=10000
\widowpenalty=10000

\righthyphenmin=2 % разрешаем переносить два последних символа

\setlength{\columnsep}{25pt}

\sloppy

\renewcommand{\bfdefault}{b} % плотный жирный

\newcommand{\mcyr}[1]{\ensuremath{\text{\textit{#1}}}}
\newcommand{\cidx}[2]{\ensuremath{#1_{\mcyr{#2}}}}
\newcommand{\lkvl}{\ensuremath{\cidx{L}{КВЛ}}\xspace}
\newcommand{\bkvl}{\ensuremath{\cidx{B}{КВЛ}}\xspace}
\newcommand{\tsr}{\ensuremath{\cidx{T}{ср}}\xspace}
\newcommand{\ve}[1]{\ensuremath{\mathbf{#1}}\xspace}
\newcommand{\gammaV}{\ensuremath{\ve{\gamma V}}\xspace}
\newcommand{\vidx}[2]{\ensuremath{\cidx{\ve #1}{#2}}\xspace}
\newcommand{\gr}{\ensuremath{\,^\circ}\xspace}
\newcommand{\grC}{\ensuremath{\,^{\circ}C}\xspace}
\newcommand{\midelsign}{\includegraphics[scale=0.035]{midel_sign_vec.eps}\xspace}
% \newcommand{\otdo}{\,\ensuremath{\div}\,}
\newcommand{\otdo}{--}
\newcommand{\motdo}{\div}
\newcommand{\ris}[1]{\ref{fig:#1}}
\newcommand{\rris}[1]{рис.~\ref{fig:#1}}
\newcommand{\Renum}{\ensuremath{\mathrm {Re}}}
\newcommand{\msq}{~м\ensuremath{^2}\xspace}
\newcommand{\gmsq}{~г/м$^2$\xspace}
\newcommand{\kgmsq}{~кг/м$^2$\xspace}
\newcommand{\speedms}{~м$/$с\xspace}
\newcommand{\coursespelengs}[1]{\ensuremath{\text{\textit{#1}}}\xspace}
\newcommand{\IK}{\coursespelengs{ИК}}
\newcommand{\IP}{\coursespelengs{ИП}}
\newcommand{\OIP}{\coursespelengs{ОИП}}
\newcommand{\KU}{\coursespelengs{КУ}}
\newcommand{\MK}{\coursespelengs{МК}}
\newcommand{\OP}{\coursespelengs{ОП}}
\newcommand{\OMP}{\coursespelengs{ОМП}}
\newcommand{\Klb}{\ensuremath{\text{\textit{К}}_{\text{\textit{лев.борта}}}}\xspace}
\newcommand{\Kpb}{\ensuremath{\text{\textit{К}}_{\text{\textit{пр.борта}}}}\xspace}
\newcommand{\KK}{\coursespelengs{КК}}
\newcommand{\KP}{\coursespelengs{КП}}
\newcommand{\OKP}{\coursespelengs{ОКП}}
\newcommand{\MP}{\coursespelengs{МП}}
\newcommand{\PU}{\mcyr{ПУ}\xspace}
\newcommand{\PUb}{\ensuremath{\mcyr{ПУ}_\beta}\xspace}
\newcommand{\AP}{\cidx{A}{П}\xspace}
\newcommand{\Ost}{\ensuremath{{O^{st}}}\xspace}
\newcommand{\tauAries}{\ensuremath{\uptau^{\text{\Aries}}}\xspace}
%\newcommand{\tAries}{\ensuremath{t^{\text{\Aries}}}\xspace}
\newcommand{\tday}{\ensuremath{^\text{д}}\xspace}
\newcommand{\tmin}{\ensuremath{^\text{м}}\xspace}
\newcommand{\thr}{\ensuremath{^\text{ч}}\xspace}
\newcommand{\tsec}{\ensuremath{^\text{с}}\xspace}
\newcommand{\TSun}{\ensuremath{T^{\text{\Sun}}}}
\newcommand{\tSun}{\ensuremath{t^{\text{\Sun}}}}
\newcommand{\TNo}{\ensuremath{T_{\text{\No}}}\xspace}
\newcommand{\mathNo}{\text{\No}}
\newcommand{\hhmm}[2]{\ensuremath{#1\thr~#2\tmin}}
\newcommand{\hhmmss}[3]{\ensuremath{#1\thr~#2\tmin~#3\tsec}}
\newcommand{\Tgr}{\cidx{T}{ГР}\xspace}
\newcommand{\ppp}{\ensuremath{\text{п.}}}
\newcommand{\grmm}[2]{\ensuremath{#1\gr\,#2'}}
\newcommand{\grmmss}[3]{\ensuremath{#1\gr\,#2'\,#3''}}

\newcommand{\p}[1]{\paragraph{#1.}\label{par:#1}}
\newcommand{\lp}[1]{#1~\pageref{par:#1}}

\newcolumntype{M}{>{\centering\arraybackslash}m{\dimexpr.25\linewidth-2\tabcolsep}}

\newcommand{\uhat}{\underaccent{\check}}

\newcommand{\uwidehat}[1]{%
  \mathpalette\douwidehat{#1}%
}

\makeatletter
\newcommand{\douwidehat}[2]{%
  \sbox0{$\m@th#1\widehat{\hphantom{#2}}$}%
  \sbox2{$\m@th#1x$}
  \sbox4{$\m@th#1#2$}
  \dimen0=\ht0
  \advance\dimen0 -.8\ht2
  \dimen2=\dp4
  \rlap{%
    \raisebox{\dimexpr\dimen0-\dimen2}{%
      \scalebox{1}[-1]{\box0}%
    }%
  }%
  {#2}%
}
\makeatother

\graphicspath{{pics/}}

% Set user input
\newcommand{\gitfolder}{.git}             % Relative path to .git folder from .tex file

\CatchFileDef{\headfull}{\gitfolder/HEAD}{}              % Get path to head file for checked out branch
\StrGobbleRight{\headfull}{1}[\head]                      % Remove end of line character
\StrBehind[2]{\head}{/}[\branch]                          % Parse out the path only
\CatchFileDef{\commit}{\gitfolder/refs/heads/\branch}{}  % Get the content of the branch head
\StrGobbleRight{\commit}{1}[\commithash]                  % Remove end of line character

\setcounter{tocdepth}{3}

\begin{document}

\frontmatter

\include{title}

\newpage

Адрес исходных файлов \url{https://github.com/drblez/yacht_captain}

Основано на ревизии \texttt{\commit} из ветки \texttt{\branch}.

Скомпилировано \today

{\small \tableofcontents}
{\small \listoffigures}
{\small \listoftables}

\mainmatter

\part{Основы теории и устройство крейсерских яхт}

\include{chapter1}
\include{chapter2}
\include{chapter3}
\include{chapter4}

\part{Яхтенное судовождение}

Судовождение --- прикладная наука, рассматривающая вопросы выбора кратчайшего пути судна и обсепечение его безопасности при плавании между заданными пунктами в море и между морскими портами. Судовождение состоит из четырех основных разделов: лоции, навигации (в том числе радионавигации и девиации магнитного компаса), астронавигации и навигационной гидрометеорологии. Здесь будут рассмотрены некоторые теоретические и основные практические сведения из этих разделов судовождения.

\include{chapter5}
\include{chapter6}
\include{chapter7}
\include{chapter8}
\include{chapter9}
\include{chapter10}

% \appendix
\part{Приложения}

\include{appendix1}
\include{appendix2}
\include{appendix3}
\include{appendix4}

\printindex

\end{document}

% Переход на NCC
%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% TeX-command-extra-options: "-shell-escape"
%%% End:
